# 230410


## OpenCV ÏòÅÏÉÅÏ≤òÎ¶¨ Í∏∞Ï¥à 1

Ïò§ÌîàÏÜåÏä§  :  BSD ÎùºÏù¥ÏÑ†Ïä§( opencv ÏÇ¨Ïö©ÌñàÎã§Í≥† Î∞ùÌûàÎ©¥ Î¨¥Î£å )

- openCV Î≤ÑÏ†Ñ 1: c , 2:c ++ 3: Î™®Îìà Ìï©Ïπ®, OpenCL ÏßÄÏõê Ïã§ÌñâÏÜçÎèÑ Í∞úÏÑ† , 4: Îî•Îü¨Îãù Ìå®ÌÇ§ÏßÄ Ï∂îÍ∞Ä

## OpenCV ÏòÅÏÉÅÏ≤òÎ¶¨ Í∏∞Ï¥à 2

- 640 x 480 Ìï¥ÏÉÅÎèÑÏùò Ïù¥ÎØ∏ÏßÄ : Î∞∞Ïó¥Ïùò ÌòïÌÉúÎäî 480 (h) x 640 (w) x 3 (B G R)
- (B,G,R) - Í∞Å ÌîΩÏÖÄÏùò Îç∞Ïù¥ÌÑ∞ ÌòïÏùÄ numpy.ndarray (heigths(rows) x width(columns)
- Ï¢åÌëúÍ∞í ÌëúÏãúÏóê ÏàúÏÑúÏåç(tuple)Ïù¥Ïö©
    
    ![Untitled](./img/Untitled.png)
    

### Ïù¥ÎØ∏ÏßÄ ÌååÏùº Îã§Î£®Í∏∞

- Ïù¥ÎØ∏ÏßÄ ÏùΩÍ∏∞, ÌëúÏãú, Ï†ÄÏû•
    
    ```python
    # ÌååÏùº ÏùΩÍ∏∞
    # ÏÇ¨Ïö©Î≤ï : cv2.imread(fileName, flag(1(color), 0 (gray), -1(unchanged))
    img = cv2.imread('lena.jpg', cv2.IMREAD_COLOR)
    
    # ÌôîÎ©¥Ïóê Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
    # ÏÇ¨Ïö©Î≤ï : cv2.imshow(title, image)
    cv2.imshow('windows name', img)
    
    # Ïù¥ÎØ∏ÏßÄÎ•º ÌååÏùºÎ°ú Ï†ÄÏû•
    # ÏÇ¨Ïö©Î≤ï : cv2.imwrite(fileName, image)
    cv2.imwrite('lenagray.png', gray)
    ```
    
- ÏòàÏãú
    
    ```python
    import cv2
    
    img = cv2.imread('test.png', cv2.IMREAD_COLOR)
    cv2.imshow('My Girl', img)
    
    cv2.waitKey(1000)
    cv2.destroyAllWindows()
    ```
    
- gray / color image Ï∞®Ïù¥
- ÏòàÏãú : Ïù¥ÎØ∏ÏßÄÏóêÏÑú Ìù∞Ï†ê ÌïòÎÇò Ï∞æÍ∏∞
    
    ```python
    import cv2 
    
    img = cv2.imread('spot.png', cv2.IMREAD_GRAYSCALE)
    h = img.shape[0]
    w = img.shape[1]
    print("The image dimension is %d x %d" % (w,h))
    
    for i in range(0, h - 1):
    	for j in range(0, w - 1):
    		if img[i, j] == 255:
    			print(i, j)
    cv2.imshow('spot', img)
    cv2.waiteKey(0)
    ```
    

### Í∏∞Î≥∏ÎèÑÌòïÍ∑∏Î¶¨Í∏∞

- img ÏúÑÏóê Îã§ÏñëÌïú ÎèÑÌòïÏùÑ Í∑∏Î¶¥ Ïàò ÏûàÏùå
- `cv2.line()`¬†,¬†`cv2.circle()`¬†,¬†`cv2.rectangle()`¬†,¬†`cv2.putText()`
    
    ```python
    # ÏÑ† (line)
    # ÏÇ¨Ïö©Î≤ï  : cv2.line(img, start, end, color, thickness)
    img = cv2.line(img, (0,0), (511,511), (255,0,0), 5)
    
    # ÏÇ¨Í∞ÅÌòï (rectangle)
    # ÏÇ¨Ïö©Î≤ï : cv2.rectangle(img, start, end, color, thickness)
    img = cv2.rectangle(img, (384, 0), (510, 128), (0,255,0), 3)
    
    # Ïõê (circle)
    # ÏÇ¨Ïö©Î≤ï : cv2.circle(img, center, radian, color, thickness)
    img = cv2.circle(img, (447,63), 63, (0,0,255), -1)
    
    # ÌÖçÏä§Ìä∏ (text)
    cv2.putText(img, text, org, font, fontSacle, color)
    cv2.putText(img, 'OpenCV', (10,500), cv2.FONT_HERSHEY_SIMPLEX, 4, (255,255,255), 2)
    ```
    
- ÏòàÏ†ú : ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞
    
    ```python
    import cv2 
    img = cv2.imread("black.png', cv2.IMREAD_COLOR)
    img = cv2.rectangle(img, (100,100), (300,400), (0,255,0), 3)
    cv2.imshow('black', img)
    cv2.waitKey(10000)
    ```
    

### Í¥ÄÏã¨ÏòÅÏó≠ - ROI(Region of Interest)

- Ïù¥ÎØ∏ÏßÄ ÎÇ¥ Í¥ÄÏã¨ÏòÅÏó≠ ÏÑ§Ï†ïÌïòÎäî Ïùº
- numpy.ndarray Îã§Ï∞®Ïõê Î∞∞Ïó¥Ïùò slicingÏúºÎ°ú
    
    ```python
    import cv2
    img = cv2.imread('car.png')
    h, w, c= img.shape
    roi = img[120:240, 270:460] # h, w
    
    cv2.imshow('roi', roi)
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break
    cv2.destroyAllWindows()
    ```
    

### HSV ÏÉâÏÉÅÏ†ïÎ≥¥

- H(hue)ÏÉâÏÉÅ, S(saturation) Ï±ÑÎèÑ, V(value) Î™ÖÎèÑ
    - Hue : ÏÉâÏùò Ïßà , ÎÖ∏ÎûÄÏÉâ, Îπ®Í∞ÑÏÉâ,,,
    - Saturation : ÏÑ†Î™ÖÎèÑ, ÏõêÏÉâÏùº ÏàòÎ°ù Ï±ÑÎèÑÍ∞Ä ÎÜíÏùå
    - Value : Î∞ùÍ∏∞ , Î™ÖÎèÑÍ∞Ä ÎÜíÏùÑ ÏàòÎ°ù Î∞±ÏÉâÏóê , ÎÇÆÏùÑ ÏàòÎ°ù ÌùëÏÉâÏóê Í∞ÄÍπåÏõåÏßê

![Untitled](./img/Untitled%201.png)

![Untitled](./img/Untitled%202.png)

- ÏÉâÏÉÅÍ≥º Î™ÖÎèÑ Î≤îÏúÑÎ°ú Ï∞®ÏÑ†Ïù∏Ïãù
    
    ```python
    import cv2
    import numpy as np
    
    img = cv2.imread('car.png')
    hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
    
    lower_white = np.array([0,0,150])
    upper_white = np.array([179,255,255])
    
    mask = cv2.inRange(hsv, lower_white, upper_white)
    
    cv2.imshow('line', mask)
    cv2.waitKey(10000)
    ```
    
    ![Untitled](./img/Untitled%203.png)
    

![Untitled](./img/Untitled%204.png)

### ÎèôÏòÅÏÉÅ ÌååÏùº ÏùΩÏñ¥ÏÑú ÌëúÏãúÌïòÍ∏∞

- ÌîÑÎ†àÏûÑ (ÏòÅÏÉÅÎÇ¥ÏóêÏÑú ÌïúÏû• ÌïúÏû•ÏùòÎØ∏)
- ÌîÑÎ†àÏûÑ Îã®ÏúÑÏùò Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌïòÏó¨ Ï£ºÌñâ Ï†úÏñ¥ Í≤∞Ï†ï
- Ïπ¥Î©îÎùºÎ°úÎ∂ÄÌÑ∞ ÏòÅÏÉÅÏ†ïÎ≥¥Î•º Î∞õÏïÑ ÌëúÏãúÌïòÎäî Í≤ÉÍ≥º ÎèôÏùºÌï® (ÏòÅÏÉÅ Ïû¨ÏÉùÏù¥ ÎÅùÎÇòÎ©¥ VideoCaptureÎ•º Îã´Í≥† ÎÅî)
    
    ```python
    import cv2 
    
    vid = cv2.VideoCapture('small.avi')
    
    while True:
    	ret, frame = vid.read()
    	if not ret:
    		break
    	if ret:
    		cv2.imshow('video', frame)
    	if cv2.waitKey(1) > 0:
    		break
    vid.release()
    cv2.destroyAllWindows()
    ```
    
    ![Untitled](./img/Untitled%205.png)
    

## OpenCV ÏûêÏù¥Ïπ¥ Ïπ¥Î©îÎùº ÌôúÏö©

### ÏûêÏù¥Ïπ¥Ïóê Ïû•Ï∞©Îêú Ïπ¥Î©îÎùº Ïû•Ïπò

- opencv Ïùò remap Í≥º Í∞ôÏùÄ Ìï®ÏàòÎ°ú ÏôúÍ≥° ÌòïÏÉÅÏùÑ Ìé¥ÏÑú ÌëúÌòÑÌï† Ïàò ÏûàÏùå

![Untitled](./img/Untitled%206.png)

- Ïπ¥Î©îÎùº ÌôúÏö© ÏÇ¨Î°Ä
    - Ï∞®ÏÑ† Ï∞æÏïÑÏÑú Ï∞®ÏÑ†ÏùÑ Î≤óÏñ¥ÎÇòÏßÄ ÏïäÍ≥† Ï£ºÌñâÌïòÎèÑÎ°ù ÎßåÎì§Í∏∞
    - ÏÇ¨ÎûåÏùÑ Ï∞æÏïÑÏÑú Ï´íÏïÑÍ∞ÄÍ∏∞
    - ÏïûÏ∞®Ïùò Îí§ÍΩÅÎ¨¥ÎãàÎ•º Ï∞æÏïÑÏÑú ÏïûÏ∞®Î•º Îî∞ÎùºÍ∞ÄÎèÑÎ°ù (Íµ∞ÏßëÏ£ºÌñâ) ÎßåÎì§Í∏∞
    - Ïπ¥Î©îÎùºÎ•º Ïù¥Ïö©Ìïú Ï£ºÎ≥ÄÏÉÅÌô© Ïù∏ÏßÄ
        - Ï†ÑÎ∞©Ïù¥ÎèôÎ¨ºÏ≤¥ Ïù∏Ïãù, Ï†ÑÎ∞© Í≥†Ï†ïÎ¨ºÏ≤¥ Ïù∏Ïãù
    - Ïπ¥Î©îÎùº ÏòÅÏÉÅÏúºÎ°ú ÏûêÍ∏∞ÏúÑÏπò ÌååÏïÖ(localization)
        - ÏïûÏóê ÌéºÏ≥êÏßÑ Ï†ÑÍ≤ΩÏùÑ Î≥¥Í≥†, ÎòêÎäî ÏßÄÌòïÏßÄÎ¨ºÏùÑ Î≥¥Í≥†, ÏßÄÎèÑ Îç∞Ïù¥ÌÑ∞ÏôÄ ÎπÑÍµêÌïòÏó¨ ÌòÑÏû¨ Ï∞®ÎüâÏùò ÏúÑÏπòÎ•º Ïú†Ï∂î
- Ïπ¥Î©îÎùº ÏúÑÏπò Ï°∞Ï†ï ÏïÑÏù¥ÏΩòÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Í≤©ÏûêÏÑ†ÏúºÎ°ú Ïπ¥Î©îÎùºÍ∞Ä Î∞îÎùºÎ≥¥Îäî Î∞©Ìñ• ÏÖãÌåÖ

### Ïπ¥Î©îÎùº Í¥ÄÎ†® ROS Ìå®ÌÇ§ÏßÄ

- Ïπ¥Î©îÎùºÎ°ú ÏòÅÏÉÅÏùÑ Îã¥ÏïÑÏÑú ÌÜ†ÌîΩÏúºÎ°ú Î≥¥ÎÇ¥Ï£ºÎäî Ìå®ÌÇ§ÏßÄÏûÑ ~/usb_cam
- /usb_cam/image_raw , /usb_cam/image_raw/compressed ÌÜ†ÌîΩ ÏÇ¨Ïö©
    
    ![Untitled](./img/Untitled%207.png)
    

### Ïπ¥Î©îÎùº ÌôúÏö© ROS ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç

### Ïπ¥Î©îÎùº ROS ÌÜ†ÌîΩÏùÑ Ïù¥Ïö©Ìïú ÎèôÏòÅÏÉÅ ÌååÏùº Ï†úÏûë

## ÏòÅÏÉÅÏ≤òÎ¶¨ Î™ÖÎèÑÏ∞® Í∏∞Î∞ò Ï∞®ÏÑ†Ïù∏Ïãù

---

**[üÜô Î™©Ï∞®Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞ üîó](https://www.notion.so/230410-7a4318b0aa194adbaacc3b8cf79add96)** 

---

# ‚öíÔ∏è week 5-1 Ïã§Ïäµ

## [Ïã§Ïäµ] Î™ÖÎèÑÏ∞® Í∏∞Î∞ò Ï∞®ÏÑ† Ïù∏Ïãù Ï£ºÌñâ

## [Í≥ºÏ†ú] RVIZ Ï∞®ÏÑ† Ïù∏Ïãù Ï£ºÌñâ

### Í≥ºÏ†úÏÑ§Î™Ö : OpenCVÏôÄ rosbagÏùÑ Ïù¥Ïö©Ìïú Ï∞®ÏÑ†Ïù∏Ïãù Ï£ºÌñâ

- rosbagÏùÑ Î∞õÏïÑÏÑú ‚Üí Í∞ÄÏÉÅÍ≥µÍ∞ÑÏóêÏÑú ÏõÄÏßÅÏùº Ïàò ÏûàÍ≤å Ìï®

![Untitled](./img/Untitled%208.png)

- Ï∞®ÏÑ† Ïù∏Ïãù Ï£ºÌñâ : Ï∞®ÏÑ†ÏùÑ Ïù∏ÏãùÌïòÎ©¥ Ï£ºÌñâÌï† Ïàò ÏûàÎèÑÎ°ù Ìï®
    - Ï¢åÏö∞ Ï∞®ÏÑ†ÏùÑ Ï∞æÏïÑÎÇ¥Ïñ¥ Ï∞®ÏÑ†ÏùÑ Î≤óÏñ¥ÎÇòÏßÄ ÏïäÍ≤åÎÅî Ï£ºÌñâÌïòÍ∏∞
    - Ïπ¥Î©îÎùº ÏûÖÎ†•ÏúºÎ°ú Ï∑®ÎìùÌïú ÏòÅÏÉÅÏóêÏÑú Ï†ÅÏ†àÌïú ÏòÅÏó≠ÏùÑ ÏûòÎùºÎÉÑ
    - Ïù¥ÏßÑÌôî ÌõÑ Î∞îÍπ•ÏóêÏÑú Ï§ëÏïôÏúºÎ°ú Í∞ÄÎ©¥ÏÑú Ìù∞ÏÉâ Ï†êÏùÑ Ï∞æÏùå
    - Í∑∏ Ï†ê Ï£ºÏúÑÏóê ÏÇ¨Í∞ÅÌòïÏùÑ Ï≥êÏÑú ÏÇ¨Í∞ÅÌòï ÏïàÏóê ÏûàÎäî Ìù∞ÏÉâÏ†êÏùò Í∞úÏàòÎ•º Íµ¨Ìï® , Í∏∞Ï§Ä Í∞úÏàò Ïù¥ÏÉÅÏù¥Î©¥ Î∞îÎ°ú Í±∞Í∏∞Í∞Ä Ï∞®ÏÑ†!
        
        ```python
        # image read
        # gray scale
        # gaussian blur
        # hsv and binary
        # ROI 
        # ÏúÑÏπò ÌååÏïÖ, Ìï∏Îì§ Í∫ΩÍ∏∞
        ```
        
- ÌååÏùº Íµ¨Ï°∞
    
    ```python
    lidar_drive
    ‚îú‚îÄ‚îÄ launch
    |   ‚îú‚îÄ‚îÄ line_follow.launch # rosbag launch Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ÏûàÏßÄ ÏïäÏùå
    |   ‚îî‚îÄ‚îÄ line_follow_rosbag.launch
    ‚îî‚îÄ‚îÄ src
        ‚îú‚îÄ‚îÄ line_follow.py
        ‚îî‚îÄ‚îÄ cam_topic.bag
    ```
    
    ![Untitled](./img/Untitled%209.png)
    
- full.bag ÌååÏùºÏóêÏÑú cam topicÎßå recode ÌïòÎäî Î∞©Î≤ï /  ÎèôÏòÅÏÉÅ Ï†ÄÏû• Î∞©Î≤ï
    
    ```python
    $ rosbag record -O cam_topic /usb_cam/image_raw/ # rosbag recoding (Ctrl+C ÎÖπÌôîÏ¢ÖÎ£å)
    
    $ rosbag play full_topic.bag
    $ rosbag info cam_topic.bag # msg Ïñ¥ÎñªÍ≤å Ï†ÄÏû• ÎêòÏóàÎäîÏßÄ ÌôïÏù∏ 
    
    # ÎèôÏòÅÏÉÅÏúºÎ°ú Ï†ÄÏû• (bag to avi)
    $ roscore
    $ rosrun image_view video_recorder image:='/usb_cam/image_raw' _filename:='track2.avi' _fps:=30 # image save
    $ rosbag play cam_topic.bag
    ```
    
- line_follow.py ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç
    
    ![Untitled](./img/Untitled%2010.png)
    
- Ï°∞Ìñ•Í∞Å ÏÑ§Ï†ï
    - Ïù∏ÏãùÎêú ÏñëÏ™Ω Ï∞®ÏÑ†Ïùò Ï§ëÏ†ê
    - Î™á ÌîΩÏÖÄÏóê 1ÎèÑÎ•º Í∫æÏñ¥Ïïº Ìï†Íπå?
- launch file
    
    ```python
    param : xycar_3d.urdf
    node : rviz + rviz_odom.rviz
    			 state_publisher
    			 converter.py
    			 rviz_odom.py
           line_follow.py
    + rosbag + cam_topic.bag
    ```
    
- Ïã§ÌñâÍ≤∞Í≥º - Í∞ÄÏÉÅÍ≥µÍ∞ÑÏóêÏÑú Ï∞®ÎüâÏù¥ Ï£ºÌñâ
    - 3Í∞úÏùò Í∑∏Î¶º ÌëúÏãú - roi&Ï¥àÎ°ùÎ∞ïÏä§ / ÏòÅÏÉÅ Ìä∏Îûô Í∫æÏûÑ(ROI ÏòÅÏó≠ ÌååÎûÄÏÉâ ÌëúÏãú) /rviz Ï∞®Îüâ ÏõÄÏßÅÏûÑ ÏùºÏπò
        
        ![Untitled](./img/Untitled%2011.png)
        
- Ï†úÏ∂ú
    - ÎèôÏòÅÏÉÅ
    - ÌååÏùº
    - Î¨∏ÏÑú

## [Í≤∞Í≥º] RVIZ Ï∞®ÏÑ† Ïù∏Ïãù Ï£ºÌñâ

# 230410 week5-1 Í≥ºÏ†ú

1. Í≥ºÏ†úÏÑ§Î™Ö
- image rosbag fileÏùÑ ÌÜµÌï¥ rvizÏóêÏÑú Ï∞®ÏÑ†Ïù∏Ïãù Ï£ºÌñâÌïòÍ∏∞
- Ìè¥Îçî Íµ¨Ï°∞

```
lidar_drive
‚îú‚îÄ‚îÄ launch
|   ‚îú‚îÄ‚îÄ line_follow.launch # rosbag launch Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ÏûàÏßÄ ÏïäÏùå
|   ‚îî‚îÄ‚îÄ line_follow_rosbag.launch
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ line_follow.py
    ‚îî‚îÄ‚îÄ cam_topic.bag

```

1. Í≥ºÏ†úÏßÑÌñâ (ÌååÏùº ÌùêÎ¶Ñ)
- /usb_cam/image_raw topic Íµ¨ÎèÖ
- ÌÜ†ÌîΩÎç∞Ïù¥ÌÑ∞Î•º opencv Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞Î°ú Î≥ÄÌôò
- opencv ÏòÅÏÉÅÏ≤òÎ¶¨(ROI -> Grayscale -> Gaussian blur -> HSV binary)
- Ï∞®ÏÑ† ÏúÑÏπò Ï∞æÍ∏∞
- Ï°∞Ìñ• Í∞Å ÏÑ§Ï†ï
- Î™®ÌÑ∞ Ï†úÏñ¥ ÌÜ†ÌîΩ Î∞úÌñâ

1. Í≤∞Í≥º
- [line_follow_rosbag.launch](https://www.notion.so/ch05ch/launch/line_follow_rosbag.launch)
- [line_follow.py](https://www.notion.so/ch05ch/src/line_follow.py)
- 
    
    ![https://www.notion.so./img/5-1.png](https://www.notion.so./img/5-1.png)
    

# TIL
