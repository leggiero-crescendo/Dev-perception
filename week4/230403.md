# 230403

# ğŸ‘©â€ğŸ« week 4-1

## ìì´ì¹´ì„¼ì„œì¥ì¹˜

- ìì´ì¹´ í•˜ë“œì›¨ì–´
    
- ìì´ì¹´ ì‹œìŠ¤í…œ êµ¬ì„±ë„
    

### ìì´ì¹´ì— ì¥ì°©ëœ ì„¼ì„œ ì¥ì¹˜ë“¤

|  | ì„¤ëª… |
| --- | --- |
| ì¹´ë©”ë¼ì„¼ì„œ | 1080P usb ì¹´ë©”ë¼
- usb2.0 , uvc ì§€ì›
- 170ë„ ì–´ì•ˆë Œì¦ˆ ( ë°˜ë“¯í•˜ê²Œ í´ì„œ ì‚¬ìš© ê°€ëŠ¥)
- CMOS OV2710 Sensor
-120-fps(640x480, 30fps(1920x1080) |
| IMU ì„¼ì„œ | 6ì¶• IMU ì„¼ì„œ MPU-6050
- ê°€ì†ë„ ì„¼ì„œ Accelerometer (ì§ì„  ê°€ì†ë„(ì›€ì§ì„ ê°ì§€, ì¤‘ë ¥ê°€ì†ë„ ê°ì§€)
- ìì´ë¡œ ì„¼ì„œ Gyroscope (íšŒì „ì†ë„ì¸ ê°ì†ë„ ê°ì§€ , roll ,pitch, yaw)
9ì¶• IMU ì„¼ì„œ SparkFun 9DoF Razor IMU M0 â†’ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ì— ë¶€ì°©
- ê°€ì†ë„, ìì´ë¡œ, ì§€ìê³„ (Nê·¹ ë°©í–¥ê°ì§€, ë™ì„œë‚¨ë¶ ë°©ìœ„ê° ê°ì§€) |
| ë¼ì´ë‹¤ ì„¼ì„œ | RPLIDAR A2(1channel , 2D lidar)
- 0.9 degree, 4,000 sampling, 15cm ~ 18meter range
1channel, 2d lidar
- 0.504 deg , 5,000 sampling, 12cm ~ 12m range,  |
| ì´ˆìŒíŒŒ ì„¼ì„œ | HC-SR04
- working voltage : DC 5V
- working current : 15mA
- working frequency : 40kHz
- max range : 4m
- min range : 2cm
- measuring angle : 15deg
- dimension : 45x20x15mm |
| Depth ì¹´ë©”ë¼ ì„¼ì„œ | Intel Realsense D 435  |

### ì¹´ë©”ë¼

- RGB(Red, Green, Blue)
    - RGBëŠ” Red, Green, Blue ë¹›ì˜ 3ì›ìƒ‰
    - RGB ê°ê° 1byte(8bits)ë¡œ í‘œí˜„
        - Full HDì˜ í¬ê¸°ëŠ” ? 1920 x 1080 x 3 bytes = 6Mbytes
- ìƒ‰ì˜ ì¸ì‹ê³¼ ì €ì¥


- í•´ìƒë„(1920 x 1080) , PPI (1ì¸ì¹˜ì— ë“¤ì–´ ìˆëŠ” pixel ìˆ˜), í™”ì†Œìˆ˜
    
    
- ì˜ìƒì´¬ì˜
    - ì—°ì†ëœ ì‚¬ì§„ì„ ì°ì–´ ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì „ì†¡
    - ìµœëŒ€ í•´ìƒë„ 1920x1080
    - í•˜ì§€ë§Œ Xycarì—ì„œëŠ” 640x480 ì‚¬ì§„ìœ¼ë¡œ ì´ˆë‹¹ 30ì¥ ì´¬ì˜
        - í™”ì†Œìˆ˜(640ã…Œ480=30ë§Œ) x í™”ì†Œë‹¹ 3bytes = ì‚¬ì§„ 1ì¥ì˜ íŒŒì¼ í¬ê¸°ëŠ” 90ë§Œ = 0.9MBytes = 7.2Mbits
        - ì´ˆë‹¹ 30ì¥ì˜ ì‚¬ì§„ì„ ì°ìœ¼ë¯€ë¡œ 1ì´ˆ ë™ì•ˆì˜ ì „ì†¡ë°ì´í„°ëŠ” 0.9M x 30ì¥ = 27MBytes = 216Mbits
        - ì „ì†¡ì†ë„ëŠ” 216Mbps, USB2.0 ì˜ ìµœëŒ€ì†ë„ëŠ” 480Mbps, ì‹¤ì œëŠ” ê·¸ ì ˆë°˜ì¸ 240Mbps
            - ë³´í†µ ì••ì¶•í•˜ì—¬ ì „ì†¡í•˜ë¯€ë¡œ ë” ë†’ì€ í•´ìƒë„ì™€ ì´ˆë‹¹ ë” ë§ì€ í”„ë ˆì„ì´ ì „ì†¡ê°€ëŠ¥
- ì¹´ë©”ë¼ ê¸°ëŠ¥ì¡°ì •
    - ë…¸ì¶œë„ Exposure
        - ì£¼ë³€ ë°ê¸°ì— ë”°ë¥¸ ì´ë¯¸ì§€ ë°ê¸° ë³€í™”
    - ìë™ì´ˆì ì¡°ì •
        - Auto-focus

### IMU

- Inertial Measurement Unit
    - ê´€ì„± ì¸¡ì • ì¥ì¹˜ - ê°€ì†ë„ê³„ì™€ íšŒì „ì†ë„ê³„, ìë ¥ê³„ì˜ ì¡°í•©ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ë¬¼ì²´(ì§ˆëŸ‰)ì— ê°€í•´ì§€ëŠ” í˜, íšŒì „ ê°ì†ë„ ë“±ì„ ì¸¡ì •í•˜ëŠ” ì¥ì¹˜
    - ë³€ìœ„ â†” ì†ë„ â†” ê°€ì†ë„

- ê°€ì†ë„ ì„¼ì„œ(accelerometer)
    - MEMSê¸°ìˆ ë¡œ ë§Œë“¤ì–´ì§„ ì„¼ì„œ
    - ë°˜ë„ì²´ ì¹© ì•ˆì— ì…ì²´ì ì¸ êµ¬ì¡°ë¬¼ ë§Œë“¤ê³ 
    - ì´ êµ¬ì¡°ë¬¼ì´ ì™¸ë¶€ì˜ í˜ì— ë”°ë¼ ì›€ì§ì´ëŠ” ê²ƒì„ ì „ê¸°ì  ì‹ í˜¸ë¡œ ë°”ê¾¸ì–´ ì¶œë ¥
    - X, Y, Z ì¶• ë°©í–¥ì˜ ì§ì„  ì›€ì§ì„ê³¼ ê¸°ìš¸ì–´ì§ ìì„¸ íŒŒì•…
        


- ì¹©ì´ ë¶• ë– ìˆì„ ë•Œ â†’ ììœ ë‚™í•˜ í•  ìˆ˜ ìˆë‹¤ê³  í•  ìˆ˜ ìˆìŒ

- ìì´ë¡œ ì„¼ì„œ (Gyro Sensor)
    - MEMS ê¸°ìˆ  ê¸°ë°˜
    - X, Y, Z ì¶•ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ íšŒì „ ì›€ì§ì„ ê°ì§€
    - [youtube.com/watch?v=eqZgxR6eRjo](https://www.youtube.com/watch?v=eqZgxR6eRjo)
    

- ì§€ìê¸°ì„¼ì„œ(Magnetometer Sensor)
    - 3ì¶• ë‚˜ì¹¨ë°˜
    - ë°©ìœ„ë¥¼ ì•Œë ¤ì£¼ëŠ” ë””ì§€í„¸ ë‚˜ì¹¨ë°˜ ê¸°ëŠ¥
    - ì§€ë„ì™€ ê²°í•©í•˜ì—¬ ë‹¤ì–‘í•œ ì‘ìš©ì œê³µ
        - ì§€ë„ì—ì„œ ìœ„ì¹˜GPSë¡œ ì–»ê³  ë°©í–¥ì„ ì¤€ë‹¤ë˜ê°€
        - ì¦ê°•í˜„ì‹¤ì„ í†µí•´ì„œ ë„ì›Œì¤€ë‹¤ë˜ê°€
- ì„¸ë°©í–¥ì˜ ì¶• Roll / pitch / yaw
    - ìì´ì¹´ëŠ” ì´ë™ë°©í–¥ ë’¤ìª½ìœ¼ë¡œ Roll
    - ì´ë™ë°©í–¥ì— ëŒ€í•˜ì—¬ ìˆ˜ì§ì„ ì´ë£¨ëŠ” ì¶• ì£¼ìœ„ì˜ íšŒì „ê°ì„ ë‚˜íƒ€ëƒ„ Pitch
    - ì´ë™ ë°©í–¥ì— ëŒ€í•˜ì—¬ ìˆ˜ì§ì„ ì´ë£¨ëŠ” ì¶• ì£¼ìœ„ì˜ íšŒì „ê°ì„ ë‚˜íƒ€ëƒ„ Yaw


### ë¼ì´ë‹¤

- ë¼ì´ë‹¤(LiDAR, Light Imaging Detection and Ranging)
    - ë ˆì´ì € ì‹ í˜¸ì˜ ë°˜ì‚¬íŒì„ ì´ìš©
    - ì§§ì€ ì£¼íŒŒìˆ˜ë¡œ ì‘ì€ ë¬¼ì²´ë„ ê°ì§€ê°€ ê°€ëŠ¥
    - ì •í™•í•œ 3D ë‹¨ìƒ‰ ì´ë¯¸ì§€ êµ¬ì„± ê°€ëŠ¥
- ë ˆì´ë‹¤(RADAR, Radio Detection and Ranging)
    - ì „íŒŒ ì‹ í˜¸ë¥¼ ë°˜ì‚¬íŒŒë¥¼ ì´ìš©
    - ì†ë„ ê°ì§€ ê°€ëŠ¥(ê²½ì°°ì˜ ê³¼ì†ì¸¡ì •ê¸°ì— ì‚¬ìš©)
    - êµ¬ë¦„ ë§ì€ ë‚ ì”¨ í™˜ê²½ ë° ì•¼ê°„ì—ë„ ì†ì‰½ê²Œ ì‘ë™
    - Lidarë³´ë‹¤ ë” ê¸´ ì‘ë™ê±°ë¦¬ë¥¼ ì œê³µ
- ë©€í‹° ì±„ë„ ë¼ì´ë‹¤
    - ex) velodyne : ìœ„ì•„ë˜ ìŠ¤ìºë‹ ê°€ëŠ¥ ì‚¬ëŒ,ì°¨ëŸ‰,ë²½, ê¸°ë‘¥ ì¸ì‹ ê°€ëŠ¥


- ëŒë°œ ì¥ì• ë¬¼
    - ë¼ì´ë‹¤ë¥¼ ì´ìš©í•˜ì—¬ ì „ë°© ì¥ì• ë¬¼ ê°ì§€
    - 0 ~ 360ë„ 1ë„ ë‹¨ìœ„ë¡œ ê±°ë¦¬ ì„¼ì‹±
    - (x,y) ì¢Œí‘œë¡œ ë³€í™˜í•˜ì—¬ ì¥ì• ë¬¼ ìœ„ì¹˜ íŒë‹¨
        - ì§„í–‰ë°©í–¥ì— ì¥ì• ë¬¼ì´ ìˆìœ¼ë©´ ì •ì§€
- ë¼ì´ë‹¤ ì„¼ì‹± ë°ì´í„°
    - 360 ë„ íšŒì „í•˜ë©´ì„œ 1ë„ì”© ì „ë°©ì— ìˆëŠ” ì¥ì• ë¬¼ê¹Œì§€ì˜ ê±°ë¦¬ë¥¼ ì„¼ì‹±
        - 360ê°œì˜ Array ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©
            - 1ë„ì”© â†’ 0.7ë„ì”© â†’ ??ë„ì”© (ë‹¤ì–‘í•œ ì„¤ì •)
    
    

### ì´ˆìŒíŒŒì„¼ì„œ

- Ultrasonic Wave ì´ˆìŒíŒŒë€? : ê°€ì²­ì£¼íŒŒìˆ˜ ëŒ€ì—­ë³´ë‹¤ ë†’ì€ ì§„ë™ìˆ˜ë¡œ ë°œìƒí•˜ëŠ” íŒŒë™ ( ê°€ì²­ì£¼íŒŒìˆ˜ì¸ 20Hz ~ 20kHz ì´ìƒ )
- ì´ˆìŒíŒŒë¥¼ ì´ìš©í•˜ì—¬ ì„¼ì„œë¡œë¶€í„° ì‚¬ë¬¼ê¹Œì§€ì˜ ì§ì„ ê±°ë¦¬ë¥¼ ì¸¡ì •
- í›„ë°© 3ê°œ ì¢Œì¸¡ 1 , ìš°ì¸¡ 1
    
    

- ì‹œê·¸ë„
    - vcc : ì„¼ì„œ ë¶€í’ˆì— ì „ë ¥ ê³µê¸‰ (DC 5v)
    - GND : íšŒë¡œì˜ ê·¸ë¼ìš´ë“œì— ì—°ê²°
    - Trig : ì„¼ì„œë¥¼ ë™ì‘ì‹œí‚¤ê¸° ìœ„í•œ íŠ¸ë¦¬ê±° ì‹œê·¸ë„(ì…ë ¥)
    - Echo : ê±°ë¦¬ì¸¡ì • ê²°ê³¼ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ì‹œê·¸ë„(ì¶œë ¥)


- ì‹œì‘ â†’ ì´ˆìŒíŒŒ ë°œì‚¬ì™€ ìˆ˜ì‹  â†’ ì‹œê°„ì°¨ ì¶œë ¥
    - ì•„ë‘ì´ë…¸ê°€ TRIG í•€ì— 10us ë™ì•ˆ High ì‹ í˜¸ë¥¼ ë‚´ë³´ëƒ„
    - ì´ˆìŒíŒŒì„¼ì„œê°€ 40kHz ì´ˆìŒíŒŒ í„ìŠ¤(pulse)ë¥¼ ì—¬ëŸê°œ ë§Œë“¤ì–´ ë¬¼ì²´ë¡œ ë³´ëƒ„
    - ë¬¼ì²´ì— ë°˜ì‚¬ëœ ì´ˆìŒíŒŒ í„ìŠ¤ê°€ ë˜ëŒì•„ê°€ì„œ ì´ˆìŒíŒŒì„¼ì„œì— ìˆ˜ì‹ ë¨
    - ì„¼ì„œëŠ” ì†¡ì‹ ê³¼ ìˆ˜ì‹ ì˜ ì‹œê°„ì°¨ì— ë¹„ë¡€í•˜ëŠ” ê¸¸ì´ì˜ í„ìŠ¤ë¥¼ Echo í•€ìœ¼ë¡œ ì¶œë ¥í•¨
    

    

- ì´ˆìŒíŒŒ ì„¼ì„œë¥¼ ì´ìš©í•œ ê±°ë¦¬ ì¸¡ì •ë°©ë²•
    - ì†Œë¦¬ ì†ë„ : 340m/s (1s ë‹¹ 340m ì´ë™)
    - 1cm ì´ë™í•˜ëŠ”ë° ì•½ 20us ì†Œìš”
    - ì†¡ì‹ ê³¼ ìˆ˜ì‹ ì˜ ì‹œê°„ì°¨ = ì´ˆìŒíŒŒì˜ ì™•ë³µ ì´ë™ì‹œê°„
    - ë¬¼ì²´ê¹Œì§€ì˜ ê±°ë¦¬  = ((ì†¡ì‹ ê³¼ ìˆ˜ì‹ ì˜ ì‹œê°„ì°¨ us / 2) / 29us) cm



- ì´ˆìŒíŒŒ ì„¼ì„œì˜ ì¸¡ì • ì˜¤ë¥˜ ( í¡ìˆ˜,,, íŠ•ê¸°ê±°ë‚˜)

### Depth ì¹´ë©”ë¼

- ìŠ¤í…Œë ˆì˜¤ ì¹´ë©”ë¼ë¥¼ ì´ìš©í•œ ê±°ë¦¬ ì¸¡ì •
- ë‘ê°œì˜ ì ì™¸ì„  ì¹´ë©”ë¼ 2ê°œ (depth) , RGB ì¹´ë©”ë¼ë¥¼ í†µí•œ ì´ë¯¸ì§€ ì •ë³´




---

## ì„¼ì„œ ROS íŒ¨í‚¤ì§€

```xml
$ rostopic lisg # list ë³´ê¸°

$ rostopic info /usb_cam/image_raw # topic ì •ë³´ í™•ì¸
$ rostopic echo /usb_cam/image_raw # ë‚ ë¼ê°€ëŠ”ê±° í™•ì¸ ì‹œì¼œì¤˜

$ rosmsg show sensor_msgs/Image # ë©”ì‹œì§€ êµ¬ì„±í™•ì¸
```

|  | ë…¸ë“œëª… | í† í”½ | ìë£Œí˜• |
| --- | --- | --- | --- |
| ëª¨í„° ì œì–´ê¸° | /xycar_motor | /xycar_motor | xycar_motor.msg |
| ë¼ì´ë‹¤ | /xycar_lidar | /scan | sensor_msgs/LaserScan |
| ì¹´ë©”ë¼ | /usb_cam | /usb_cam/image_raw  (/compressedâ†’ ì•ˆë“œë¡œì´ë“œ)  | sensor_msgs/Image |
| ì´ˆìŒíŒŒ ì„¼ì„œ | /xycar_ultrasonic | /xycar_ultrasonic | std_msgs/Int32MultiArray |
| IMU ì„¼ì„œ | /xycar_imu | /imu | sensor_msgs/Imu |
| Depth cam | /camera/realsense2_camera | /camera/color/image_raw
/camera/depth/image_rect_raw |  |

### ì¹´ë©”ë¼ë¥¼ ìœ„í•œ ROS package

- UVC(USB Videocamera) - ì›¹ìº ê³¼ ê°™ì€ ë²”ìš© USB ì¹´ë©”ë¼ ì œì–´ìš© ROS pkg ì‚¬ìš©
- usb_cam-test.launchë¥¼ í™•ì¸í•´ ë³´ë©´ íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸ í•´ ë³¼ ìˆ˜ ìˆë‹¤.

```
# sensor_msgs/Image
std_msgs/Header header
	uint32 seq
	time stamp
	string frame_id
uint32 height
uint32 width
string encoding
uint8 is_bigendian
uint32 step
uint32[] data # ì‹¤ì œ ì˜ìƒ ë°ì´í„°
```

### IMU ë…¸ë“œì˜ ì‹¤í–‰

- xycar_imu_9dof.launch â†’ xycar_imu_9dof_noviwer.launch

```xml
# sensor_msgs/Imu
std_msgs/Header header
	uint32 seq
	time stamp
	string frame_id
geometry_msgs/Quaternion orientation	#RPYì— ëŒ€í•œ ë°ì´í„°
	float64 x
	float64 y
	float64 z
	float64 w
float64[9] orientation_covariance
geometry_msgs/Vector3 angular_velocity	#ê°ì†ë„ì— ëŒ€í•œ ë°ì´í„°
	float64 x
	float64 y
	float64 z
float64[9] angular_velocity_covariance
geometry_msgs/Vector3 linear_velocity	#ì„ ì†ë„ì— ëŒ€í•œ ë°ì´í„°
	float64 x
	float64 y
	float64 z
float64[9] linear_acceleration_covariance
```


### Lidar

- lidar.launch â†’ lidar_noviewer.launch / rviz

```
# sensor_msgs/LaserScan

std_msgs/Header header
	uint32 seq
	time stamp
	string frame_id
float32 angle_min
float32 angle_max
float32 angle_increment
float32 time_increment
float32 scan_time
float32 range_min
float32 range_max
float32[] ranges		# ê±°ë¦¬ì •ë³´
float32[] intensities	# ë¬¼ì²´ì˜ ê°•ë„
```


### ì´ˆìŒíŒŒ ì„¼ì„œ

- xycar_ultrasonic.launch

```
# std_msgs/Int32MultiArray

std_msgs/MultiArrayLayout layout
	std_msgs/MultiArrayDimension[] dim
	    string label
		uint32 size
		uint32 stride
	uint32 data_offset
int32[] data			# ì´ˆìŒíŒŒ ë°ì´í„°
```

### Depth ì¹´ë©”ë¼

- demo_pointcloud.launch

```
# sensor_msgs/Image
std_msgs/Header header
	uint32 seq
	time stamp
	string frame_id
uint32 height
uint32 width
string encoding
uint8 is_bigendian
uint32 step
uint32[] data # ì‹¤ì œ ì˜ìƒ ë°ì´í„°
```


## IMU ì„¼ì„œ í™œìš©

### IMU ì„¼ì„œë¥¼ ìœ„í•œ ROSë…¸ë“œì™€ í† í”½

- xycar_imu ì— ë…¸ë“œ ê´€ë ¨ íŒŒì¼ ìˆìŒ (type : sensor_msgs/IMU)


```xml
# sensor_msgs/Imu

std_msgs/Header header # header (ì‹œí€€ìŠ¤ë²ˆí˜¸ì™€ ì‹œê°„, ì•„ì´ë”” ì •ë³´ë¥¼ ë‹´ìŒ)
	uint32 seq
	time stamp
	string frame_id
geometry_msgs/Quaternion orientation	# Quaternion ì •ë³´ë¥¼ ì§€ë‹˜
	float64 x
	float64 y
	float64 z
	float64 w
float64[9] orientation_covariance
geometry_msgs/Vector3 angular_velocity	#ê°ì†ë„ì— ëŒ€í•œ ë°ì´í„°
	float64 x
	float64 y
	float64 z
float64[9] angular_velocity_covariance
geometry_msgs/Vector3 linear_velocity	#ì„ ì†ë„ì— ëŒ€í•œ ë°ì´í„°
	float64 x
	float64 y
	float64 z
float64[9] linear_acceleration_covariance
```

### IMU ë°ì´í„°ì—ì„œ Roll , Pitch, Yaw ê°’ ì¶œë ¥

my_imu íŒ¨í‚¤ì§€ ìƒì„±

```xml
catkin_create_pkg my_imu std_msgs rospy
# launch, python 
```

roll_pitch_yaw.py

```python
#!/usr/bin/env python
import rospy
import time

from sensor_msgs.msg import Imu # Imu msg ì‚¬ìš© ì¤€ë¹„
from tf.transformations import euler_from_quaternion # euler_from_quaternion í•¨ìˆ˜ ì‚¬ìš© ì¤€ë¹„

Imu_msg = None

def imu_callback(data):
	global Imu_msg
	# imu data ê°€ ë“¤ì–´ì˜¤ë©´ ì‹¤í–‰ë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì •ì˜
	Imu_msg = [data.orientation.x, data.orientation.y, data.orientation.z, data.orientation.w] 

rospy.init_node("Imu_Print") # imu node ì´ë¦„ì˜ ë…¸ë“œ ìƒì„±
rospy.subscriber("imu", Imu, imu_callback) # imu í† í”½ì´ ì˜¤ë©´ ì½œë°±í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë„ë¡ ì„¸íŒ…

while not rospy.is_shutdown():
	if Imu_msg == None:
			continue
	(roll, pitch, yaw) = euler_from_quaternion(Imu_msg) # x,y,z,w querternion -> roll, pitch, yaw
	print('roll:%.4f, pitch:%.4f, yaw:%.4f'%(roll, pitch, yaw)) # í™”ë©´ì— roll, pitch, yaw ê°’ ì¶œë ¥
	time.sleep(1.0)

```

roll_pitch_yaw.launch

```python
<launch>
	<node pkg="xycar_imu" type="9dof_imu_node.py" name="xycar_imu" ouput="screen">
		<param name="rviz_mode" type="string" value="false" />
	</node>
	<node pkg="my_imu" type="roll_pitch_yaw.py" name="Imu_Print" output="screen" />
</launch>
```

---

## IMU ë°ì´í„° ì‹œê°í™”

### IMU ë°ì´í„° ì‹œê°í™” plug-in ì„¤ì¹˜

- rviz_imu_plugin.tgz íŒŒì¼ ë³µì‚¬
- rviz_imu pkg ìƒì„±
    
    ```python
    catkin_create_pkg rviz_imu ropsy tf geometry_msgs urdf rviz xacro
    cd ~/rviz_imu
    mkdir -p launch rviz
    touch ./rviz/imu_3d.rviz
    touch ./launch/imu_3d.launch
    ```
    
- imu_3d.launch
    
    ```python
    <launch>
    	<!-- rviz display -->
    	<node name="rviz_visualizer" pkg="rviz" type="rviz" required="true" args="-d $(find rviz_imu)/rviz/imu_3d.rviz"/>
    	<node pkg="xycar_imu" type="9dof_imu_node.py" name="xycar_imu" output="screen">
    		<param name="rviz_mode" type="string" value="false" />
    	</node>
    </launch>
    ```
    

- rviz ì„¤ì •
    
    ![Untitled](230403%20771a9264f9244f4eb4874b964c0c56b8/Untitled%2032.png)
    
    ![Untitled](230403%20771a9264f9244f4eb4874b964c0c56b8/Untitled%2033.png)
    

![Untitled](230403%20771a9264f9244f4eb4874b964c0c56b8/Untitled%2034.png)

![Untitled](230403%20771a9264f9244f4eb4874b964c0c56b8/Untitled%2035.png)

## Pygame í”„ë¡œê·¸ë˜ë°



## ì°¨ëŸ‰ì£¼í–‰ ì‹œë®¬ë ˆì´í„° ì„¤ê³„


## Pygame ì°¨ëŸ‰ ì£¼í–‰ ì‹œë®¬ë ˆì´í„° ì œì‘

---

# âš’ï¸ week 4-1 ì‹¤ìŠµ

## ê³¼ì œ ëª©í‘œ : IMU ë°ì´í„°ë¡œ ë·°ì–´ ë°•ìŠ¤ë¥¼ ì›€ì§ì´ì

- ë°ì´í„° ì „ë‹¬ íë¦„
- ì£¼ì–´ì§„ imu_data.txt íŒŒì¼ì—ì„œ í•œì¤„ì”© ì½ì–´ì™€ì„œ imu msg íƒ€ì…ì— ë§ê²Œ ê°€ê³µ , ê°€ê³µëœ ë°ì´í„°ë¥¼ /imu í† í”½ì— ë„£ì€ í›„ RVIZ ë·°ì–´ë¥¼ í–¥í•´ ë°œí–‰
    
    
    ```python
    # í´ë” êµ¬ì„±
    rviz_imu
    â”œâ”€â”€ launch
    |   â””â”€â”€ imu_generator.launch
    â”œâ”€â”€ src
    |   â”œâ”€â”€ imu_generator.py
    |   â””â”€â”€ imu_data.txt
    â””â”€â”€ rviz
        â””â”€â”€ imu_generator.rviz
    
    ```
    
- ê³¼ì œ íŒíŠ¸ 1 (ì†¡ì‹  ë°ì´í„°ì˜ íƒ€ì…í™•ì¸)
    - imu_data.txt format : roll : value, pitch : value, yaw : value (valueëŠ” radian)
- ê³¼ì œ íŒíŠ¸ 2 (ìˆ˜ì‹ ë¶€ ë°ì´í„° íƒ€ì… í™•ì¸)
    - sensor_msgs/Imu â†’ quaternionì„ ë‹´ìŒ ì†¡ì‹ ê³¼ëŠ” ë‹¤ë¥´ê²Œ
        
        
    - from tf.transformations import quaternion_from_euler
- ê³¼ì œ íŒíŠ¸ 3 : imuê°€ ë³´ë‚´ëŠ” í† í”½ì„ ë°›ì•„ì„œ imu_data.txt íŒŒì¼ì„ ë§Œë“œëŠ” íŒŒì´ì¬ ì½”ë“œ!
    - imu_data_maker.py
        
        ```python
        #!/usr/bin/env python
        
        import rospy, math, os
        from sensor_msgs.msg import Imu
        fro tf.transformations import euler_from quaternion
        
        deg2rad = float(math.pi)/float(180.0)
        rad2deg = float(180.0)/float(math.pi)
        name=" >> ./imu_data.txt"
        
        def listener():
        	rospy.init_node('imu_data_maker', anonymous=False)
        	rospy.Subscriber('imu', Imu, callback)
        def call_back(data):
        	global deg2rad
        	global rad2deg
        
        euler = euler_from_quaternion((data.orientation.x, data.orientation.y, data.orientation.z, data.orientation.w))
        euler = [euler[0], euler[1], euler[2]]
        save_str = "roll : " + str(euler[0]) + ", "+"pitch:"+str(euler[1])+","+"yaw :"+str(euler[2])
        command = 'echo"'+ save_str +'" >> ./imu_data/txt'
        print(command)
        os.system(command)
        
        if __name__ == '__main__':
        	listener()
        	try:
        			rospy.spin()
        	except keyboardInterrupt:
        			print("shutting down")
        ```
        
- ì‘ì„± ë°©ë²• (txt ì½ì–´ì„œ rviz ì†¡ì¶œ)

```python
#!/usr/bin/env python

import rospy, math, os
from sensor_msgs.msg import Imu
from tf.transformations import quaternion_from_euler

# publisher ë…¸ë“œ ì„ ì–¸ imu íƒ€ì… í† í”½ ì •ì˜ 

rospy.init_node('imu_pub')
rospy.Publisher('imu', Imu, queue_size = 1)

# imu_data.txt íŒŒì¼ì—ì„œ í•œì¤„ì”© ì½ìŒ
# í† í”½ì— ë‹´ì•„ ë°–ìœ¼ë¡œ publish
# ëª¨ë‘ ë‹¤ ì½ì–´ì„œ ë³´ëƒˆìœ¼ë©´ ì¢…ë£Œ 

```

- launch

```python
<launch>
	<!-- rviz display -->
	<node name="rviz_visualizer" pkg="rviz" type="rviz" required="true" args="-d $(find rviz_imu)/rviz/imu_generator.rviz"/>
	<node name="imu_generator" pkg="rviz_imu" type="imu_generator.py" output="screen"/>

</launch>
```

## ê²°ê³¼ ì œì¶œ ë°©ë²•

- ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ ê²°ê³¼ í™•ì¸

```python
roslaunch rviz_imu imu_generator.launch
rostopic echo /imu
```

- ë™ì˜ìƒ ì œì¶œ
    - RVIZì—ì„œ IMU 3D í˜•ìƒì´ ì›€ì§ì´ëŠ” ê²ƒì„ íœ´ëŒ€í°ìœ¼ë¡œ ì´¬ì˜í•˜ì—¬ ì œì¶œ
- íŒŒì¼ ì œì¶œ
    - Launch íŒŒì¼ê³¼ Imu_generatoríŒŒì¼ ì œì¶œ
- ë¬¸ì„œì œì¶œ
    - imu_generatorpy íŒŒì¼ ì†ŒìŠ¤ì½”ë“œ ìƒì„¸ ì‘ì„±

---

## RVIZ imu veiwer ì‹¤ìŠµ

- [rospkg.RosPack()](http://docs.ros.org/en/independent/api/rospkg/html/python_api.html)
- êµ¬ì„±í•´ì•¼í•  topic
    
    ```python
    std_msgs/Header header # header (ì‹œí€€ìŠ¤ë²ˆí˜¸ì™€ ì‹œê°„, ì•„ì´ë”” ì •ë³´ë¥¼ ë‹´ìŒ)
    	uint32 seq
    	time stamp
    	string frame_id
    geometry_msgs/Quaternion orientation	# Quaternion ì •ë³´ë¥¼ ì§€ë‹˜
    	float64 x
    	float64 y
    	float64 z
    	float64 w
    ```
    
- python file
    
    ```python
    #!/usr/bin/env python
    #-*- coding: utf-8-*-
    import rospy, math, os, rospkg
    from sensor_msgs.msg import Imu
    from tf.transformations import quaternion_from_euler
    
    # publisher ë…¸ë“œ ì„ ì–¸ imu íƒ€ì… í† í”½ ì •ì˜ 
    
    rospy.init_node('imu_generator')
    pub = rospy.Publisher('imu', Imu, queue_size = 1)
    
    path = rospkg.RosPack().get_path('rviz_imu')+"/src/imu_data.txt"
    f = file(path, "r") # txt file read
    lines = f.readlines() # all file read -> readline(1 line) , readlines(all)
    
    imu_data = []
    
    imuMsg = Imu()
    imuMsg.header.frame_id = 'map' # Imu header frame idë¥¼ mapìœ¼ë¡œ ì§€ì •
    r = rospy.Rate(10)
    seq = 0
    
    # imu_data.txt íŒŒì¼ì—ì„œ í•œì¤„ì”© ì½ìŒ
    if os.path.exists(path):
    	for line in lines: # roll, pitch , yaw ê° ê°’ ì €ì¥
    		line = line.replace(':',',')
    		tmp = line.split(",")
    		extract = quaternion_from_euler(float(tmp[1]), float(tmp[3]), float(tmp[5]))
    		imuMsg.orientation.x = extract[0]
    		imuMsg.orientation.y = extract[1]
    		imuMsg.orientation.z = extract[2]
    		imuMsg.orientation.w = extract[3]
    
    		# header ì •ë³´ ì¶”ê°€í•˜ê¸°
    		imuMsg.header.stamp = rospy.Time.now()
    		imuMsg.header.seq = seq
    		seq = seq + 1
    
    		# í† í”½ì— ë‹´ì•„ ë°–ìœ¼ë¡œ publish
    		pub.publish(imuMsg)
    		r.sleep()
    ```
    

# TIL
