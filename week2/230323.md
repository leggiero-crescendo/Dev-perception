# 230323(목) - 리눅스 파일시스템, 패키지 매니저
1. [File system](#file-system) 

2. [Package Manager](#package-manager)
3. [APT](#apt)
     ```
     - advanced package tools
     - sources.list
     - mirror site
     - apt vs apt-get, apt-cache
     ```
4. [Ubuntu network configuration](#ubuntu-network-configuration)
---
## File system
### Partition

- disk label
- partition type

**Partition** 

⇒ Physical 혹은 logical 구획 : 과거에는 physical partition만 존재

⇒ 최근에는 logical parition 선호 : 대표적으로 logical Volume(LVM)을 사용하는 방법 물리적 구획을 우선으로 하고 Locgical partition을 사용할 수 있게 함 → 디스크를 묶어서  용량보다 큰 파티션도 만들 수 있음 

**disklabel type**

- DOS / GPT 방식
- DOS partition 종류 :  Primary partition(주) , Extended partition(확장), Logical drive(논리 드라이브)
### fdisk /dev/sda를 이용한 파일 시스템 변경
![image](https://user-images.githubusercontent.com/125112464/227134349-95039298-b9a2-4606-9ce3-5a4a6ee5c2cc.png)

## Package-Manager
```shell
dpkg -s # 패키지 상태확인
     -S # 패키지 검색 : 파일 명 (dpkg -S /bin/ls)
     --audit # 수정
     -l # list 확인
```

## APT

### apt (adv.package tool)

- debian 의 dpkg를 랩핑한 front-end tool → dependency 탐색 및 설치 기능을 좋게한 것이 apt system
- binary : apt-get(install/remove/upgrade) , apt-cache(query)
- binary-extensions : apt-file
- new binary : apt (최신 툴)

### apt (source list)

- 내가 받기 위한 source가 있는 곳을 지정하는 방법
- /etc/apt/sources.list : 를 직접 편집해도 되지만 추가할 경우에 /etc/apt/sources.list.d/에 *.list 파일명으로 추가하는 편이 좋음
- 주로 편집시 apt edit-sources 명령어로 가능
- sources.list format
    
    ```bash
    deb [option1=value1 option2=value2] uri suite [component1] [component2] [...] # debian package를 가져오는 것
    deb-src [option1=value1 option2=value2] uri suite [component1] # debian package안의 source code를 가져오는 것 
    
    ```
    
    - uri : DEB 패키지를 제공하는 사이트의 URI
    - suite : distribution codename 디렉터리 이름 (==dist. version)
    - c[omponent : suite의 구성 요소 및 라이선스 종류별 분류](https://help.ubuntu.com/community/Repositories)
        
        아래 세가지가 가장 유용하게 쓰임
        
        - main : officially supported (ubuntu에서 직접관리하는)
        - restricted :  free license
        - universe : 완전 officially 는 아니지만 절반 정도!
        
        ---
        
        - security
        - updates
        - proposed
        - backports
        - multiverse

### apt : source list : debian : append

- source list에 URL을 추가 하는 방법 → 직접 추가를 하면 좋은 과정은 아니지만 할 수는 있음
- 실제로는 /etc/apt/sources.list.d/kr.list  로 폴더 밑에 만들어서 추가 함
    

### Practice : Ubuntu 18.04

- Kakao mirror 설정방법
    - 편집대상 파일 : /etc/apt/sources.list.d/kakao.list
        - sudo select-editor 로 vim editor로 설정하자
        - sudo apt edit-sources kakao.list
        
        ```bash
        # kakao mirror : ubuntu 18.04 LTS
        deb http://mirror.kakao.com/ubuntu/ bionic main restricted universe
        deb http://mirror.kakao.com/ubuntu/ bionic-updates main restricted universe
        deb http://mirror.kakao.com/ubuntu/ bionic-security main restricted universe
        ```
        
    - vim : normal 에서는 저장 나오기 ZZ / 또는 :x == :wq
    - 앞에꺼 다 막 # 쳐서 카카오 꺼만 쓰면 좀 더 빠르긴 하다고 함
        - Ctrl-V 해서 colum 편집기능으로 한번에 바꿀 수 있으니
        

### apt : list

- apt list [options] [package pattern]
- 패키지 목록 출력
- options :
    
    ```bash
    # apt list
    # apt list --installed # 설치된 패키지 리스트
    # apt list --upgradable # 업그레이드가 가능한 패키지 리스트
    # apt list bash* # 모든 버전의 패키지 리스트
    ```
    

### apt : search

- apt search [-n] <regex>
- 패키지를 키워드로 검색, 키워드는 REGEX로 입력
- options
    
    ```bash
    # apt search bash #name이 아닌 descriotion에 bash가 들어간 경우까지 검색한다.
    # apt search -n bash #name의 중간에 bash가 있어도 검색한다.
    # apt search -n '^bash' #name의 시작부분에 bash가 있는 경우만 검색한다.
    ```
    

### apt : show

- apt show <package name>[=version]
    
    ```bash
    # apt show bash
    # apt list --all-versions bash
    Listing... Done
    bash/bionic-updates,bionic-security,bionic-updates,bionic-security 4.4.18-2ubuntu1.3 amd64 [upgradable from: 4.4.18-2ubuntu1.2]
    bash/now 4.4.18-2ubuntu1.2 amd64 [installed,upgradable to: 4.4.18-2ubuntu1.3]
    bash/bionic,bionic 4.4.18-2ubuntu1 amd64
    
    # apt show [특정버전명지정]
    ```
    

### apt : remove, purge, autoremove

- remove : 패키지만 삭제 (config 파일은 남겨둠)
- purge : 설정이 꼬이거나, 완전삭제 (config 도 삭제)
- autoremove : 의존성이 깨지거나 버전 관리로 인해 쓰이지 않는 패키지를 자동 제거

### apt : install : unmet dependency #1

- univers 를 source.list에서 빼먹었을 경우 깨질 경우도 있음 (version이 다르다)    

### apt : install :unmet dependency #2

- downgrade 하는 법
    
    ```bash
    # apt list --all-versions libcurl3-gnutls # 모든 버전을 다 확인한 다음
    # apt install curl libcurl3-gnutls=7.47.0-1ubuntu2 # 버전 별로 설치하면 됨
    ```
Debian NM

- NetworkManager 설정
- nmcli

---
## Ubuntu network configuration
### NetworkManager

- deamon으로 작동하면서 network configuration을 수행하고, 자동으로 network connection을 관리(연결 감지, 해제, 재시도)수행
- systemd 기반의 다른 linux distribution들에게도 동일한 방식의 경험을 제공함
- Ethernet, wi-Fi, Mobile broadband등의 다양한 기능들에게 플랫폼을 제공함

### legacy: ifconfig, route, ip, nmcli

- UNIX standard command(POSIX)
    - ifconfig
    - route
- Non-standard command(linux specific)
    - ip
    - nmcli
    - ethtool, pifconfig & pethtool

### nmcli

- network manager CLI tool
    
    ```bash
    # nmcli g[eneral] # 현재 상태를 보여줌 state, connection
    # nmcli n[etworking] # networking 상태 조회 enable/disable
    # nmcli n [on/off] # off 로 설정 되있으면 안되는 경우도 있으니 확인하기!
    # nmcli dev # d도 가능 
    
    ```
    

### nmcli : device naming

- eth#[:n] : old style (EL6이전에서 주로 쓰임 - 어떤 것이 뭐에 할당하는지 확인하기 어려움 마치 lsusb 해서 찾을 때 막 장치를 빼서 알아야하는 것처럼)
- Consistent Network Device Naming
    - prefix
        - en : ethernet
        - wl : wireless lan
        - ww : wireless wan
    - following device name
                
    
    

### NIC : nmcli : command

```shell
# nmcli g #general 
# nmcli r # radio
# nmcli c # connection
## help 가 제공됨
# nmcli c[onnection] s[how] <connection name> 
```

- ipv[46].* : 설정된 값 (offiline)
- IP[46].* : 할당된 값 (online)

### nmcli : con : property

- 주요 속성
    - ipv4.method
        - auto | manual
        - auto = dhcp
        - manual = static ip
    - ipv4.addr
        - IPv4 address CIDR 표기법 = 192.168.110.50/24
    - ipv4.gateway : Gateway IP
    - ipv4.dns : DNS server IP

### nmcli : con : property (con’t)

- optional prefix of property
    - (+ / - / none)

```shell
# nmcli d #connection을 down 시키고 show로 확인
# nmcli con down "[CONNECTION]"  # connection 연결 down됨
# nmcli con up "[CONNECTION]"  # connection 재연결 됨
# nmcli c s "[CONNECTION]" # 연결 확인
```

- modifiy

```shell
# nmcli con modify "[CONNECTION- 기존]" connection.id <바꾸고 싶은 이름-ex)ens33> 
# nmcli c s ens33 # 기존값 적어두기 
# nmcli c mod ens33 ipv4.method manual ipv4.addresses 192.168.XXX.110/24 \
	ipv4.gateway 192.168.XXX.2 +ipv4.dns 8.8.8.8 # XXX -> 원래 기존 넘버로 작성
# nmcli c down ens33 && nmcli c up ens33 # routing table 변경없이 IP 변경 정도를 반영하는 경우는 up만 다시 하면 됨
# nmcli c s ens33 # 확인
```

### virtual ip 추가

- 서버를 논리적으로 분리하고 싶을 때 여러개의 ip 주소를 할당하는
    
    

### nmcli : con : del /add

```shell
# nmcli c del ens33 # 설정 삭제
# nmcli c s 
# nmcli d s
# nmcli c add con-name ens33 ifname ens33 type ethernet \
	ip4 192.168.110.161/24 ## ifname - 실제 디바이스 네임
# nmcli c mode ens33 +ipv4.dns 8.8.8.8 # dns 추가
```


### Case 1 : disconnected


```shell
disconnected 되어 있으면 연결 해줘야함
# nmcli dev connect ens33

```

### Case 2 : dev
```shell
# device 란이 --로 비어 있으면 
# nmcli n # networking 검사
# nmcli n on
# nmcli g # 로 먼저 확인해주세요 lshw, lspci, lsusb, dmseg 와 같이 하드웨어적으로 확인가능
```
